<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Создание WMS-сервиса на базе QGIS Mapserver</title>

<topbar style="display:none;">
    <item><a href="../index.html">Домой</a></item>
    <item><a href="../intro.html">О курсе</a></item>
</topbar>

</head>
<body>
<xmp theme="simplex" style="display:none;">

Рассмотрим ещё один WMS-сервер - QGIS Mapserver, позволяющий использовать
символику проектов, созданных в QGIS.

Основные характеристики QGIS Mapserver:

* открытый (GPL) WMS-сервер;
* представляет собой FastCGI/CGI приложение, написанное на C++;
* позволяет публиковать как векторные, так и растровые данные;
* управление символикой из настольного клиента QGIS.

Установка QGIS Mapserver
------------------------

Для установки QGIS Mapserver установим следующие пакеты:

     sudo aptitude install qgis-mapserver libapache2-mod-fcgid

И перезапустим Apache:

    sudo service apache2 restart

Чтобы проверить, что QGIS Mapserver установился корректно, откроем в
браузере следующую страницу:

    http://10.22.0.9/cgi-bin/qgis_mapserv.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetCapabilities

Если по указанному адресу открывается страница, представляющая собой
ответ сервера GetCapabilities, значит QGIS Mapserver установился корректно.

Создание проекта QGIS
---------------------

1. Запускаем QGIS (1.8) и добавляем в проект 4 слоя из базы данных
   PostGIS `dbvega`;

2. Настраиваем символику и изменяем имена в списке слоёв на следующие:

   * **Водоёмы** - цвет заливки (181 210 214), без обводки;
   * **Здания** - цвет заливки (206 154 156), обводки (106 106 106);
   * **Железнодорожные станции** - значок из библиотеки символов *station.svg*
     (размер 5);
   * **Дороги** - первый слой - толщина 1.4, цвет(0 0 0), второй слой -
     толщина 1, цвет (255 255 255).

   Должна получиться вот-такая картина:

   ![][02-qgis-mapserver-01]

3. В меню *Файл* выбираем *Сохранить проект как* и сохраняем проект под
   именем *qgis-mapserver-1.8.qgs*.


Публикация проекта
------------------

1. На сервере переходим в каталог */usr/lib/cgi-bin*, создаём в нём
   ещё один каталог *vega*, и делаем необходимый симлинк:

       cd /usr/lib/cgi-bin
       sudo mkdir vega
       cd vega
       sudo ln -s ../qgis_mapserv.fcgi .

2. Копируем файл *qgis-mapserver-1.8.qgs* в директорию */usr/lib/cgi-bin/vega*;

3. Перезапускаем Apache:

       sudo service apache2 restart

4. В QGIS создаём подключение к WMS-серверу `http://10.22.0.9/cgi-bin/vega/qgis_mapserv.fcgi`,
   при этом отмечаем пункты *Игнорировать URI запроса GetMap* и *Игнорировать
   URI запроса GetFeatureInfo*:

   ![][02-qgis-mapserver-02]

5. Подключаемся к созданному подключению и добавляем на карту WMS-слои, убеждаясь в
   том, что они имеют такое же оформление, как и в проекте QGIS.

[02-qgis-mapserver-01]: ../img/02-qgis-mapserver-01.png
[02-qgis-mapserver-02]: ../img/02-qgis-mapserver-02.png


QGIS Mapserver развивается очень стремительно и в последних версиях реализована
поддержка в том числе и WFS.

</xmp>
<script src="../strapdown/v/0.2/strapdown.js"></script>
<script src="../strapdown-topbar/assets/strapdown/strapdown-topbar.min.js"></script>
<script src="../strapdown-topbar/assets/logo.js"></script>
<script src="../license.js"></script>
</body>
</html>
