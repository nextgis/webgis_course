<!DOCTYPE html>
<html>
<title>MapServer MapScript</title>

<xmp theme="united" style="display:none;">

Установка Python MapScript
--------------------------

Для установки Python [MapScript](http://mapserver.org/mapscript/index.html)
API выполните следующую команду:

    sudo aptitude install python-mapscript

Чтобы убедиться в том, что MapScript установлен корректно, выполните
команду:

    python -c "import mapscript"

Если в результате выполнения данной команды вы не увидите никаких сообщений
об ошибках, значит MapScript установлен корректно.

Cоздание враппера c использования MapScript
-------------------------------------------

Сфера применения MapScript очень широка. Можно, например, в соответствии
с переданными клиентом параметрами HTTP запроса генерировать каждый
раз новый map-файл, что открывает возможности создания очень гибких
сервисов. Можно написать собственные обработчики для различных
запросов и т.д. В качестве примера напишем универсальный враппер для
WMS(WFS) запросов.

В настоящий момент времени адреса веб сервисов имеют вид:

    http://10.22.0.9/cgi-bin/mapserv?map=/home/rykovd/wms/wms.map&
    http://10.22.0.9/cgi-bin/mapserv?map=/home/rykovd/wfs/wfs.map&

Как вы можете заметить, в этом случае адрес получается довольно
длинным, да и к тому же указывается путь до map-файла
в файловой системе. Если мы переместим наш map-файл в другое место,
то будем вынуждены сообщить об этом всем клиентам, использующим наш сервис,
иначе он будет недоступен. Для решения данной проблемы существует
множество [способов](http://mapserver.org/ogc/wms_server.html#changing-the-online-resource-url),
рассмотрим один из них.

Переходим в каталог */usr/lib/cgi-bin* и создаём 2 файла *wms* и *wfs*:

    cd /usr/lib/cgi-bin
    sudo touch wms
    sudo touch wfs

В каждый файл помещаем следующий код. Для *wms*:

    #!/usr/bin/python
    import mapscript
    req = mapscript.OWSRequest()
    req.loadParams()
    map = mapscript.mapObj('/home/rykovd/wms/wms.map')
    map.OWSDispatch(req)

Для *wfs*:

    #!/usr/bin/python
    import mapscript
    req = mapscript.OWSRequest()
    req.loadParams()
    map = mapscript.mapObj('/home/rykovd/wfs/wfs.map')
    map.OWSDispatch(req)

Делаем их исполняемыми:

    sudo chmod o+x wms
    sudo chmod o+x wfs

Затем в файлах *wms.map* и *wfs.map* изменим значение **wms_onlineresource**
и **wfs_onlineresource** на:

    http://10.22.0.9/cgi-bin/wms?
    http://10.22.0.9/cgi-bin/wfs?

Проверьте результат на примере подключения в QGIS.

</xmp>
<script src="../strapdown/v/0.1/strapdown.js"></script>
</html>